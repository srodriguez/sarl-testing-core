package io.sarl.testing.core

import io.sarl.lang.core.Address
import io.sarl.lang.core.Behavior
import io.sarl.lang.core.Capacity
import io.sarl.lang.core.Event
import io.sarl.lang.core.EventSpaceSpecification
import io.sarl.lang.core.Skill
import io.sarl.lang.core.SpaceID
import io.sarl.sre.capacities.InternalSchedules
import io.sarl.sre.internal.eventguard.BehaviorGuardEvaluatorRegistry
import io.sarl.sre.skills.internal.EventBus
import java.util.UUID
import java.util.function.Supplier
import io.sarl.sre.skills.bic.SchedulesSkill

/** 
 * @author Sebastian Rodriguez
 * 
 */
agent TestingAgent {
	val sup = new Supplier<InternalSchedules> {
	
	def get : InternalSchedules {
		new SchedulesSkill(new TestingExecutorService)
	}
	
}
	val eventBus = new EventBus(sup, new BehaviorGuardEvaluatorRegistry)

	val defaultAddress = new Address(new SpaceID(this.ID, UUID.randomUUID, EventSpaceSpecification), this.ID)

	new() {
		super(UUID.randomUUID, UUID.randomUUID)

	}

	def getDefaultAddress : Address {
		this.defaultAddress
	}

	def withSkill(s : Skill, cap : Class<? extends Capacity>) : TestingAgent {
		setSkill(s, cap)
		this
	}

	def registerBehavior(b : Behavior) {
		this.eventBus.register(b, null, null)
	}

	def perceive(e : Event) {
		this.eventBus.immediateDispatch(e,true)
	}

}
